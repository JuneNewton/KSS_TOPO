"use-struct";const fs=require("fs"),path=require("path"),MAIN_CONFIG_FILE="../../Config/project_config.json",{workerData:workerData,parentPort:parentPort,threadId:threadId}=require("worker_threads"),logger=require("ksl-log-helper").logger,logLevel=workerData.logLevel;logger.setLevel(logLevel),logger.info("Parse Runbg Data Worker ID:"+threadId);class KSLParseRunBGData{constructor(){let e=JSON.parse(fs.readFileSync(path.join(__dirname,MAIN_CONFIG_FILE),"utf-8"));this.clientName=e.ClientName}analysisRealData(e){let r=e.unhandledDataObj,t=e.topic,a=e.subscribeTopicObj,s=new Map;for(let e=0;e<r.length;++e)s.set(r[e].N,r[e]);let o={},l=[],n={};try{for(let[e,r]of a){for(let e=0;e<r.Tags.length;++e){let t=s.get(r.Tags[e]);void 0!==t&&l.push(t)}if(0!==l.length){o=l;let a={};a.From=this.clientName,a.RequestId=r.requestId,a.TagValues=o,n[t]={topic:e,msg:a}}}}catch(e){logger.error("Parse RunBG Data Error->"+e.message)}return n}}const KSLParseRunBGObj=new KSLParseRunBGData;parentPort.on("message",e=>{let r=KSLParseRunBGObj.analysisRealData(e),t={};t.msg=r,parentPort.postMessage(t)});